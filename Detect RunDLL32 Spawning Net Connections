rule rule_rundll32_network {
  meta:
    author = "Greimore1"
    description = "Detects rundll32.exe initiating network connections"
    severity = "Medium"

  condition:
    $matched := filter(
      $event,
      $event.metadata.event_type == "NETWORK_CONNECTION_ATTEMPT" and
      $event.process.file.full_path contains "rundll32.exe"
    )
    $matched
}

outcome:
  $target_ips = array_distinct($matched.network.destination_ip)
  $ports = array_distinct($matched.network.destination_port)
