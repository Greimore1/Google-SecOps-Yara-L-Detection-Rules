
rule rule_win_password_spray {
  meta:
    author = "Greimore1"
    description = "Detects a password spraying attempt using repeated failures from same IP"
    severity = "High"

  condition:
    $matched := filter(
      $event,
      $event.metadata.event_type == "AUTHENTICATION_FAILURE" and
      $event.network.source_ip == "192.168.1.10" // replace with dynamic logic if needed
    )
    $matched
}

outcome:
  $user_ids = array_distinct($matched.principal.user.user_id)
  $source_ips = array_distinct($matched.network.source_ip)
